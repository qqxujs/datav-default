<!DOCTYPE html> 

本教程主要介绍DataV分析模式的基本概念，帮助用户以灵活、0代码、自动化的方式使用数据和分析数据，支持数据的下钻和联动分析。

## 前提条件

在您了解组件分析模式这部分内容前，您需要提前了解DataV6.0数据集：请参见[DataV6.0数据集介绍](https://help.aliyun.com/zh/datav/datav-6-0/user-guide/datav-6-0-dataset#task-2138931)。

## 进入组件分析模式

### 方法一：从资产面板创建

1. 登录[DataV控制台](https://datav.aliyun.com/)[](https://datav.alibabacloud.com/)。
2. 在**我的可视化**页面，单击您创建的可视化应用项目上方的**编辑**按钮。
3. 进入画布编辑器中，单击选择**BI分析**模块，通过将组件拖拽到画布编辑中实现创建分析组件并进入组件分析模式。![BI分析模式](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3128079361/p370691.png)

### 方法二：通过右键菜单转换

在支持分析模式的组件或包含有支持分析模式子组件的地图上，您可以通过单击组件，并右键单击打开菜单弹窗，再单击**转为分析模式**，将选中的组件转换为分析模式。

**说明** 

含有多个子组件的地图组件，在转为分析模式时您需要选择转换组件的范围。

![image](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/1271425761/p554650.png)![image](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/1271425761/p554651.png)

### 方法三：通过数据面板切换

您可以在支持分析模式的组件**数据面板**右上角，单击选择切换为**分析模式**。![image](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/1271425761/p554656.png)

## 配置组件分析交互

### 交互一：数据下钻

| **事件** | **说明**                                                                                                                                                                              |
| ------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 下钻     | 对数据集进行下钻展示的功能。                                                                                                                                                                      |
| 下钻配置   | 您可以单击**数据面板**上字段右侧的下钻图标，并单击选择**层级下钻**。![下钻](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4128079361/p370696.png)**说明** 开启下钻的字段必须是一个没有聚合的字段，您可以添加多个字段，也可以上下拖拽调整下钻维度。 |
| 下钻预览   | 您可以在可视化应用的预览页和发布页中，单击查看下钻交互的效果，左上角面包屑菜单显示下钻路径，通过单击面包屑菜单可以返回指定的下钻层级。![下钻预览](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/2062549361/p368352.png)                     |
| 下钻行为配置 | 您可以在分析器右侧面板的**交互**页面进行分析交互相关的配置，包括选择**触发其它组件联动**或者**接收其它组建联动**等联动功能。![下钻行为配置](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/2062549361/p368354.png)                  |

### 交互二：数据筛选

联动筛选：分析模式组件允许互相联动，通过单击选中的方式进行筛选。

**说明** 

一个组件会与同一画布上其它组件进行联动，并且联动是双向的，可以在联动配置中选择关闭部分联动。

筛选的前提条件：

* 开启了相关配置项。
* 使用相同的数据集。

开启联动后，在其中一个组件上的点击选择会筛选相关组件展示的结果。![条形图配置](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4128079361/p370700.png)

## 分析模式说明

### 如何与蓝图配合

蓝图编辑器配置说明：分析模式组件无法导出到蓝图，但分析器可以导出到蓝图。![image](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/2042425761/p554679.png)

**说明** 

如果分析器内包含多于一个分析模式组件（例如**基础平面地图 3.0**中的多个子组件），则需要额外指定对象组件的ID。

### 受到限制的操作

* 图层移动：分析器内只有一个组件，将其它组件拖拽到分析器内会报错，移动组件会连同分析器一起移动。
* 复制和收藏：单独复制和收藏分析组件是不允许的，编辑器会提示是否需要连同分析器一并复制和收藏。
* 导出到蓝图：分析模式组件无法导出到蓝图，但是分析器可以导出到蓝图。
* 转为区块：分析模式组件及分析器不可以转为区块，同时包含分析模式组件的组或者表单组也不可以转为区块。

### 产生变化的操作

* 删除组件：在删除分析模式组件时，分析器会同步删除。
* 添加和删除子组件：在非分析模式的地图组件内创建分析模式子组件时，会提示是否需要转为分析模式并添加分析器。当分析模式地图内的最后一个分析模式子组件被删除时，会提示是否需要退出分析模式并删除分析器。

### 自动化配置说明

* 添加字段后自动打开对应视觉通道的映射（颜色、大小等）。
* 删除字段后自动关闭对应视觉通道的映射（恢复固定值）。
* 字段自动选择聚合方式。
* 自动选择地理角色（经度、纬度、adcode）。

### 对原分析组件的兼容性支持

原分析组件已经配置的内容可以继续展示，但是无法修改。如果您需要修改内容，需转为分析模式，原字段配置将会保留。![设置数据源](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/2062549361/p368554.png)

## 实操演示

直播视频以公司销售订单数据为例，介绍2个分析组件联动筛选的配置、下钻以及用蓝图配置，去触发下钻和选中的操作。

1. 登录[DataV控制台](https://datav.aliyun.com/)[](https://datav.alibabacloud.com/)。
2. 在**我的可视化**页面，单击您创建的可视化应用项目上方的**编辑**按键，进入画布编辑器中。
3. 单击选择**BI分析**模块，将**柱状图**组件拖拽到画布编辑器中，并选择配置一个数据集，具体设置方法请参见：[DataV6.0数据集介绍](https://help.aliyun.com/zh/datav/datav-6-0/user-guide/datav-6-0-dataset#task-2138931)。
4. 在**图表配置**模块，通过拖拽方式设置`x`字段为**类别**，`y`轴为**价格**，`颜色映射`为**价格**，并设置对应的颜色，`拆分`设置为**日期**，除此之外，设置**类别**的下钻字段内容为**子类别**。![图表配置](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/8238359361/p368666.png)
5. 在可视化应用预览页查看您设置的效果，左上角为面包屑菜单。![预览柱状图下钻效果](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5870147461/p368672.png)
6. 在画布编辑器页面，单击添加一个**条形图**组件，在分析数据面板中，选择和**柱状图**组件一样的数据集 ，在图表配置模块，设置`x`轴为**价格**，`y`轴为**类别**，并设置下钻字段内容为**订单状态**和**子类别**，`颜色映射`为**价格**，**`拆分`**为**日期**。![条形图配置](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/8238359361/p368694.png)
7. 单击切换到组件的**交互**页签中，选择**触发方式**为**点击**，单击切换到**配置**面板，设置**图形**配置项中**映射类型**为**名词分类**。
8. 在可视化应用预览页中查看联动效果，当您选中左边**柱状图**组件内的数码产品时，右边**条形图**组件会根据左边选中的内容，同步筛选展示数码产品的详细信息；当您在**条形图**组件设置了已支付和付款中的下钻子层级，左边**柱状图**组件也将同步联动筛选对应的内容。![联动筛选结果预览](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/8238359361/p368711.png)

**说明**  
  * 关于联动模式的选择，当需要下钻时，可以选择**下钻优先**模式，如果需要先设置筛选，不需要下钻，可以设置为**选中优先**模式。
  * 您也可以在联动模块设置是否需要触发或者接收其它组件联动。
9. 单击选择分析器，并右键单击**导出到蓝图编辑器**，直播视频中以**Tab列表**组件触发**下钻**和**回退下钻**的动作，实现满足时触发下钻；不满足时触发回退的动作效果。  
对于下钻的处理方法，您可以参见以下代码：  
```  
return {  
  "id": "",  
  "items": [  
    {  
      "x": "数码产品"  
    }  
  ]  
};  
```  
对于回退下钻的处理方法，您可以参见以下代码：  
```  
return {  
  "depth": 0,  
  "forceClear": false  
};  
```  
按照如下图将多个组件和节点连线：![蓝图编辑器配置](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/8238359361/p368814.png)
10. 单击蓝图编辑器右上角的**正常预览**图标，即可预览蓝图编辑器中设置的效果，其中页面内的**Tab2**按键设置的是下钻效果，您可以看到**柱状图**组件下钻到对应的数码产品；**Tab3**按键设置的是回退下钻效果，可以回退下钻模式。![预览](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/8238359361/p368764.png)
11. 在蓝图编辑器画布中， 按照如下代码，为下钻或选中变动时设置隐藏按钮；同时，您也可以设置蓝图连线并记录蓝图日志，随时查看执行的过程。  
```  
return {  
  "animationType": "fade",  
  "animationDuration": 1000,  
  "animationEasing": "linear"  
};  
```

## **视频链接**

DataV小课堂直播视频：[分析模式浅尝](https://cloud.video.taobao.com/play/u/null/p/1/e/6/t/1/d/ud/345571516825.mp4)。